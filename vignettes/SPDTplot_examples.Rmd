---
title: "SPDTplot examples"
author: "Paul Askey"
date: "08/12/2021"
output: html_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(knitr)
library(formatR)
opts_chunk$set(tidy.opts=list(width.cutoff=80),tidy=TRUE)

```


## Getting Started

See  https://github.com/PAskey/SPDT#readme to get instructions on how to install package and ensure you are connected to the database server at work or through the vpn if you are at home. Once installed use following code to load the package for use.

```{r setup, warning=FALSE,message=FALSE}
library(SPDT)
library(tidyverse)
```

OK, now we use the primary function SPDTdata() to download and clean all the small lakes data that is from stocked fish. SPDT data takes several arguments to refine data: Spp, Strains, and Contrast. Since this vignette is about producing plots, we will want a fairly focused data set (e.g. just filtering to something broad like Species, would lead to so much data that plots would be very cluttered and not meaningful). In general the plotting function works when you want to look at a specific contrast between stocking groups. 

With this in mind, let's look at two specific stocking product examples.

## Example: Using the filtered SPDT data set to plot contrasts in 3N vs 2N performance in Kokanee

If we are interested in a specific type of experimental contrast we can select for lake-years with relevant experiments. One example would be to look at the relative performance of different genotypes for Kokanee. Which would be found using the code line below:

```{r message=FALSE, warning=FALSE, results  ='hide'}
SPDTdata(Spp = "KO", Contrast = "Genotype")
```

There is a long list of plots that can be created from SPDTplot(). Now if we re-run a plot it will only have those lakes of interest. There are many plots we can run with SPDTplot:


```{r fig.height=7, fig.width=10, message=FALSE, warning=FALSE}
SPDTplot(Metric = "FL_freq", min_N = 20)
SPDTplot(Metric = "age_freq")
SPDTplot(Metric = "survival")
SPDTplot(Metric = "maturation_by_sex")
```

Now let's look at the Kokanee data with Genotype contrast every which way:

```{r fig.height=10, fig.width=10, message=FALSE, warning=FALSE}

SPDTplot(Metric = "growth_FL")
#This throws error unless remove all the NAs, i.e. change min_N >0 
SPDTplot(Metric = "mu_growth_FL")
SPDTplot(Metric = "mu_growth_FL", min_N = 10)
SPDTplot(Metric = "FL_density", min_N = 20)
```



## Example: Using the filtered SPDT data set to plot contrasts in Carp Lake vs Blackwater or Horsefly strains.


We could also do the same for a strain contrast. Let's look at any strain comparisons using Carp Lake, Blackwater, or Horsefly.


```{r fig.height=7, fig.width=10, message=FALSE, warning=FALSE}
SPDTdata(Strains = c("CL", "BW", "HF"), Contrast = "Strain")
SPDTplot("age_freq")
SPDTplot("survival")
SPDTplot("maturation_by_sex")
```

```{r fig.height=10, fig.width=10, message=FALSE, warning=FALSE}
SPDTplot("mu_growth_FL")
SPDTplot("growth_FL")
```


